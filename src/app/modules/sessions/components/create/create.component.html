<div>
  <app-section-header *ngIf="mode == 'create'" title="{{ mode == 'create' ? 'Create Session' : 'Session'}}"
    [buttons]="headerButtons" (actionClick)="actionClick($event)"></app-section-header>
</div>


<form [formGroup]='form' [@flyIn]>

  <!--  Format  -->
  <div>
    <div class="row justify-content-between align-items-center no-gutters">
      <h6 class="col sub-header ml">Format</h6>
    </div>
    <div >
      <app-select-format [selectedFormat]='form.get("format").value'></app-select-format>
    </div>
  </div>




  <!--  Course  -->
  <div>
    <div class="row justify-content-between align-items-end no-gutters">
      <h6 class="col sub-header ml">Course</h6>
      <div class="col-xs" *ngIf="form.get('course').value">
        <a mat-flat-button color="transparent-warn" (click)="clearCourse()">
          <span class="icon-x-circle"></span>
        </a>
      </div>
    </div>

    <div [@flyIn] *ngIf="form.get('course').value; else coursePicker">
      <course-list-item [course]='form.get("course").value' mode='list'></course-list-item>
    </div>

    <ng-template #coursePickerDialog>
      <div class="row justify-content-center align-items-center no-gutters">
        <div class="col">
          <a mat-raised-button class="btn btn-block btn-lg" color="accent">Select a Course</a>
        </div>
      </div>

    </ng-template>
    


    <ng-template #coursePicker>
      <div [@flyIn]>
        <mat-tab-group dynamicHeight="true">
          <mat-tab>
            <ng-template mat-tab-label>
              <span class="icon-heart" matTooltip='Favorites'></span>
            </ng-template>

            <h3>Favorites</h3>
            <app-course-list type='favorites' mode='selector'></app-course-list>


          </mat-tab>

          <mat-tab>
            <ng-template mat-tab-label>
              <span class="icon-clock" matTooltip="Recient"></span>
            </ng-template>

            <h3>Recient</h3>
            <app-course-list type='recient' mode='selector'></app-course-list>
          </mat-tab>

          <mat-tab>
            <ng-template mat-tab-label>
              <span class="icon-search" matTooltip="Search"></span>
            </ng-template>
            <app-course-search header="false">
            </app-course-search>
          </mat-tab>
        </mat-tab-group>
      </div>

    </ng-template>
  </div>





  <!--  Time  -->
  <div>
    <div class="row justify-content-between align-items-end no-gutters">
      <h6 class="col sub-header ml">Time</h6>
    </div>

    <div class="row justify-content-between align-items-end">
      <div class="col">
        <mat-form-field>
          <mat-label matPrefix>Date</mat-label>
          <input matInput [matDatepicker]="picker" placeholder="mm/dd/yyyy" formControlName='date'
            (focus)="picker.open()" type="text">
          <mat-datepicker-toggle matSuffix [for]="picker"><span class='icon-calendar'></span></mat-datepicker-toggle>
          <mat-datepicker #picker startView="year" [startAt]="form.get('date').value" touchUi="true"></mat-datepicker>
          <mat-error *ngIf="form.get('date').touched && form.get('date').invalid">
            Invalid Date
          </mat-error>
        </mat-form-field>
      </div>



      <div class="col">
        <mat-form-field>
          <mat-label matPrefix>Time</mat-label>
          <input matInput [ngxTimepicker]="timePicker" placeholder="hh:mm AM/PM" formControlName='time' type="text">
          <div matSuffix><a mat-flat-button color="transparent-primary" (click)="timePicker.open()"><span
                class="icon-clock"></span></a></div>
          <ngx-material-timepicker #timePicker minutesGap=5 disableAnimation="true">
          </ngx-material-timepicker>
          <mat-error *ngIf="form.get('time').touched && form.get('time').invalid">
            Invalid Time
          </mat-error>
        </mat-form-field>
      </div>
    </div>
  </div>



  <!--  Teams -->
  <div>
    <div *ngIf="form.get('format').valid && form.get('format').value.enum != 'ffa'">
      <div class="row justify-content-between align-items-end no-gutters">
        <h6 class="col sub-header ml">Teams</h6>
        <div class="col-xs">
          <a mat-flat-button color="transparent-accent" (click)="addTeam()">
            <span class="icon-plus-circle"></span>
          </a>
        </div>

      </div>

      <div @flyIn>
        <team-list-item *ngFor="let team of form.get('teams')?.controls; trackBy: trackTeamBy" [team]="team.value"
          mode='remove'></team-list-item>
      </div>
    </div>
  </div>




  <!--  Players  -->
  <div>
    <div class="row justify-content-between align-items-center no-gutters">
      <h6 class="col sub-header ml">Players</h6>
    </div>

    <div>
      <mat-tab-group dynamicHeight="true">
        <mat-tab>
          <ng-template mat-tab-label>
            <span class="icon-heart"></span>
          </ng-template>

          <p>Favorites</p>

        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <span class="icon-clock"></span>
          </ng-template>

          <p>Recient</p>

        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <span class="icon-search"></span>
          </ng-template>
          <app-select-players (selected)="addScore($event)"></app-select-players>
        </mat-tab>
      </mat-tab-group>

    </div>
  </div>



  <!--  Roster  -->
  <div>
    <div class="row justify-content-between align-items-end no-gutters">
      <h6 class="col sub-header ml">Roster</h6>
      <div *ngIf='sessionForm.teamGame && form.get("teams").controls.length == 0' class='col color-warn message'>
        <label class="mat-body-strong">Add Teams!</label>
      </div>
    </div>

    <div cdkDropListGroup class="row justify-content-center align-items-start no-gutters">



      <div class="col-12 teamDropPad unassigned mb-3" (cdkDropListDropped)="rosterDrop($event)" cdkDropList
        [cdkDropListData]="getRoster(null)" id="team-unassigned">

        <label>{{ sessionForm.teamGame ? 'Unassigned' : 'Players' }}</label>
        <score-list-item cdkDrag [cdkDragData]="player" [score]="player" [mode]="playerModes"
          *ngFor="let player of getRoster(null)">
        </score-list-item>
      </div>


      <div class="col-12 teamDropPad {{ team.value.color.name }}"
        *ngFor="let team of form.get('teams').controls; let i = index" (cdkDropListDropped)="rosterDrop($event)"
        cdkDropList [cdkDropListData]="getRoster(team)" id="{{ 'team-' + team.value.color.name }}">


        <label>{{ team.value.name | titlecase }}</label>
        <score-list-item cdkDrag [cdkDragData]="player" [score]="player" [mode]="playerModes"
          *ngFor="let player of getRoster(team)">
        </score-list-item>
      </div>
    </div>
  </div>


</form>


<div class="row no-gutters justify-content-stretch align-items-center mt-3 mb-5">

  <div class="col">
    <a mat-raised-button color="primary" class="btn btn-lg btn-block" (click)="sessionForm.submitCreation()"
      [disabled]="!sessionForm.ReadyForSubmission()">
      <label>Create</label>
    </a>
  </div>
</div>